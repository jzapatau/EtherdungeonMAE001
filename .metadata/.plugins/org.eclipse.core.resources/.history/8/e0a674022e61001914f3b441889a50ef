// --------------------------------------------------------
// Code generated by Papyrus Java
// --------------------------------------------------------

package MAE1Project;

//------------------ IMPORT MODULES ---------------------------//

import java.util.ArrayList;

/************************************************************/
/**
 * @author Felix Zapata
 * Date: 3/04/2019
 * 
 * Game class is the commanding class of the entire program. It
 * controls the flow of the program since its beginning until it's
 * end.
 */
public class Game {
	
	// ------------------------------ PROPERTIES -----------------------------//
	
	/**
	 * ui class is used to interface with the ui of the program
	 */
	private UI ui;
	/**
	 * encounter is an array of class Encounter to keep a log of the
	 * encounters taken.
	 */
	private ArrayList<Encounter> encounters;
	/**
	 * settings define the different settings of game which are later used to start the game
	 */
	private Settings settings;
	
	// ------------------------------ METHODS -------------------------------//
	
	/**
	 * main method of the Game, which sets off the game.
	 * @param args
	 */
	public static void main(String[] args) {
		
		// This methods is the initializer of the game, and thus should have 3 main events:
		// 1. The game starts (call Game class constructor)
		// 1.a. The Game is presented to the User/s
		// 1.b. Settings are established by user input according to the fashion described in the manual.
		//		These includes:
		//		1.b.1. Player Mode definition
		//		1.b.2  Users definition.
		//		1.b.3  Teams definition.
		//		1.b.4  Characters definition.
		// 2. The game starts, and the Encounters take place.
		// 3. When either the amount of encounters won reaches a certain value or the user looses (SinglePlayerMode
		//    only) the game ends by printing a closure message.
		// 4. Program is finished.
		
		// Call the game class constructor
		Game myGame = new Game();
		
		// Run the Game;
		myGame.runGame();
		
		// Program finishes
	}

	/**
	 * Class constructor
	 */
	public Game() {
		// Define the properties
		ui = UI.INSTANCE;
		encounters = new ArrayList<Encounter>();
		
		// Present the game
		presentGame();
		
		// Ask for settings
		settings = new Settings();
		
		
	}
	
	/**
	 * presentGame is a private method which presents the game to the user with an
	 * introductory message that's appealing to it.
	 */
	private void presentGame() {
		// Present the GAME to the user
		String out = "\n --------------------------------------- WELCOME!!!!!!!-----------------------------------------------\n";
		out += "\n..this is MISTS OF ETHERDUNGEON.. are you ready to play you filthy mortal?.....\n";
		out += "\nEpisode IV, A NEW HOPE\n\n"
				+ "It is a period of civil war. \n"
				+ "Rebel spaceships, striking from a hidden base, \n"
				+ "have won their first victory against the evil Galactic Empire. \n"
				+ "During the battle, Rebel spies managed to steal secret plans \n"
				+ "to the Empire’s ultimate weapon, the DEATH STAR,\n"
				+ "an armored space station with enough power to destroy an entire planet.\n"
				+ "Pursued by the Empire’s sinister agents, Princess Leia races home \n"
				+ "aboard her starship, custodian of the stolen plans that can save \n"
				+ "her people and restore freedom to the galaxy…."
				+ "\n\n PROPOERTY OF LOUCASFILM LTD 2019\n\n...";
		
		out += "\n\n ... now enough bullshit ... time to light up this game!!!";
		
		// Print to screen
		ui.printToScreen(out);
	}
	
	/**
	 * endGame method is a private method which outputs the ending message of the game
	 */
	private void endGame() {
		// Close the GAME to the user
		String out = "\n --------------------------------------- GAME OVER!!!!!!!--- -----------------------------------------\n";
		out += "Thank you for playing !!!!";
		
		// Print the message to the screen
		ui.printToScreen(out);
	}
	
	/**
	 * runGame is the method which executes the game per se and starts it.
	 */
	public void runGame() {
		// Print the start up
		String out = "\n ...OK, WE ARE ALL SET GUYS, LET'S START!!!!!!!! .......\n";
		ui.printToScreen(out);
		
		// Run the encounters
		for (int i = 0; i < settings.getPlayerMode().getMaxEncounters(); i++) {
			Encounter newEncounter = generateNewEncounter();
			newEncounter.runEncounter();
			
			// Check for the encounter was won, in such a case account for it 
			if (newEncounter.isWon())
			{
				// Re-condition after encounter according to the player mode
				settings.getPlayerMode().reconditionAfterEncounter(settings, newEncounter);
			}
			else {
				// If the encounter was not won then break the loop
				break;
			}
		}
		
		// Close the game
		endGame();
	}
	
	/**
	 * generateNewEncounter generates a new Encounter with the userHero and userMonster
	 * @return Encounter instance
	 */
	private Encounter generateNewEncounter() {
		// Call out the teams
		User<Hero> userHero = settings.getUserHero();
		User<Monster> userMonster = settings.getUserMonster();
		
		// Return the newEncounter object
		return new Encounter(userHero, userMonster);
		}
	
	/**
	 * reconditionAfterEncounter reconditions the game after an encounter has taken place, as expected
	 * it will depend on the nature of the player mode.
	 * @param oldEncounter: previous encounter from which we want to know if it was won or not
	 */
	private void reconditionAfterEncounter(Encounter oldEncounter) {

		// Re-populate the corresponding team that is virtual
		User<Monster> userMonster = settings.getUserMonster();
		User<Hero> userHero = settings.getUserHero();
		if (userMonster.isVirtual()) {
			// Replace the old user with new characters. Update the opposing team
			userMonster.getCharacter().generateVirtualUser(settings, userMonster.getName());
			userHero.getTeam().resetTeam();
		}
		if (userHero.isVirtual()) {
			// Replace the old user in the settings character. Update the opposing team
			userHero.getCharacter().generateVirtualUser(settings, userHero.getName());
			userMonster.getTeam().resetTeam();
		}
	}

		
		

	
	// -------------------------- GETTERS AND SETTERS -----------------------//

	public UI getUi() {
		return ui;
	}

	public void setUi(UI ui) {
		this.ui = ui;
	}

	public ArrayList<Encounter> getEncounters() {
		return encounters;
	}

	public void setEncounters(ArrayList<Encounter> encounters) {
		this.encounters = encounters;
	}

	public Settings getSettings() {
		return settings;
	}

	public void setSettings(Settings settings) {
		this.settings = settings;
	}
	

};
